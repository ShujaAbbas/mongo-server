<html>

	<head>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>

		<script type="text/javascript">
			
				function loginRequest(e) {
					var formData = JSON.stringify($("#loginForm").serializeArray());
					console.log("here");
					$.ajax({

						type: "POST",
						url: "/todo/api/v1.0/tasks/greet",
						data: formData,
						async: true,
						success: function(data){
							console.log("here2");
							var result = JSON.stringify(data);
							var json = JSON.parse(result);

							console.log("Hello world" + json.result);

							if (json.result === "True"){
								console.log("Trueeee");

								localStorage.setItem("name", JSON.parse(formData)[0].value);
								console.log("Name is : " + localStorage.getItem("name"));

								location.href = "/todo/api/v1.0/tasks?username="+localStorage.getItem("name");
								
								return false;
							}else{
								console.log("Falseeee");
								return false;
							}
						},
						error: function (jqXHR, exception) {
					        var msg = '';
					        if (jqXHR.status === 0) {
					            msg = 'Not connect.\n Verify Network.';
					        } else if (jqXHR.status == 404) {
					            msg = 'Requested page not found. [404]';
					        } else if (jqXHR.status == 500) {
					            msg = 'Internal Server Error [500].';
					        } else if (exception === 'parsererror') {
					            msg = 'Requested JSON parse failed.';
					        } else if (exception === 'timeout') {
					            msg = 'Time out error.';
					        } else if (exception === 'abort') {
					            msg = 'Ajax request aborted.';
					        } else {
					            msg = 'Uncaught Error.\n' + jqXHR.responseText;
					        }
					        $('#post').html(msg);
					    },
						dataType: "json",
						contentType : "application/json"
					});
				}
		</script>

	</head>
	<body>

		<script>
			if (Modernizr.localstorage) {
				console.log("Browser Supported");
			} else {
			  	console.log("Browser Not Supported");
			}
		</script>

		<form id="loginForm" onsubmit="loginRequest()">
			Email: <input id="name" type="text" name="name" placeholder="Email"><br>
			Password: <input type="password" name="password" placeholder="Password">
			<input type="submit" value="Login">
		</form>

		<p id="post">Default value</p>

	</body>

</html>
